<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<script>
		function doLogout() {
			const Http = new XMLHttpRequest();
			const url = 'http://127.0.0.1:8001/login';

			Http.open("DELETE", url);
			Http.send();

			Http.onload = function () {
				switch (Http.status) {
					case 200:
						document.cookie = "";
						window.location.href = '/login'
						break;

					default:
						alert("Logout failed due to: " + Http.statusText);
						break;
				}
			};
		}
	</script>
	<link rel="stylesheet" href="../chat/chat.css">
</head>

<body>
	<div class="bg"></div>
	<div id="wrapper">
		<table>
			<tr id="header">
				<td id="title" class="column">Some dialog</td>
				<td id="info" class="column">
					<button onclick="doLogout()">Info</button>
				</td>
			</tr>
			<tr>
				<td id="dialog" class="column">
					<div class="message myMessage">
						<p>bot 1</p>
					</div>
					<div class="message chatMessage">
						<p>bot 2</p>
					</div>
				</td>
			</tr>
		</table>
	</div>

	<script>
		let socket = new WebSocket("ws://127.0.0.1:8001/chat/activeUsers");
		
		socket.onopen = function(e) {
			console.log("Connection established");
		};

		socket.onmessage = function(event) {
			if (event.data.startsWith("-a"))
			{
				alert("New user " + event.data.substr(2))
			}
			else
				if (event.data.startsWith("-d"))
				{
					alert("Off user " + event.data.substr(2))
				}
			console.log(`New message: ${event.data}`);
		};
	</script>
</body>

</html>